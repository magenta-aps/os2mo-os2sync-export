# SPDX-FileCopyrightText: Magenta ApS <https://magenta.dk>
# SPDX-License-Identifier: MPL-2.0

fragment AddressFields on AddressResponse {
  current {
    address_type_response {
      uuid
    }
    visibility_response {
      current {
        scope
      }
    }
    value
  }
}

fragment UnitFields on OrganisationUnitResponse {
  current {
    uuid
    name
    parent_response {
      current {
        uuid
        itusers_response(
          filter: { user_keys: ["FK-ORG-UUID", "FK-ORG UUID"] }
        ) {
          objects {
            current {
              user_key
            }
          }
        }
      }
    }
    ancestors {
      uuid
    }
    unit_type_response {
      uuid
    }
    unit_level_response {
      uuid
    }
    unit_hierarchy_response {
      current {
        name
      }
    }
    addresses_response {
      objects {
        current {
          address_type_response {
            current {
              scope
              uuid
              user_key
            }
          }
          name
        }
      }
    }
    itusers_response(filter: { user_keys: ["FK-ORG-UUID", "FK-ORG UUID"] }) {
      objects {
        current {
          user_key
        }
      }
    }
    managers_response {
      objects {
        current {
          person_response {
            current {
              itusers_response(
                filter: {
                  itsystem: { user_keys: ["FK-ORG-UUID", "FK-ORG UUID"] }
                }
              ) {
                objects {
                  current {
                    external_id
                  }
                }
              }
            }
          }
        }
      }
    }
    kles_response {
      objects {
        current {
          kle_number_response {
            uuid
          }
        }
      }
    }
  }
}

query ReadUserITAccounts(
  $uuid: UUID!
  $it_user_keys: [String!]
  $email: [UUID!] = []
  $mobile: [UUID!] = []
  $landline: [UUID!] = []
) {
  persons(filter: { uuids: [$uuid] }) {
    objects {
      current {
        fk_org_uuids: itusers_response(
          filter: { itsystem: { user_keys: ["FK-ORG-UUID", "FK-ORG UUID"] } }
        ) {
          objects {
            current {
              uuid
              user_key
              external_id
            }
          }
        }
        itusers: itusers_response(
          filter: { itsystem: { user_keys: $it_user_keys } }
        ) {
          objects {
            current {
              user_key
              external_id
              person_response {
                current {
                  cpr_number
                  name
                  nickname
                }
              }
              engagements_responses {
                objects {
                  current {
                    extension_3
                    org_unit_response {
                      ...UnitFields
                    }
                    job_function_response {
                      current {
                        name
                      }
                    }
                  }
                }
              }
              email: addresses_response(
                filter: { address_type: { uuids: $email } }
              ) {
                objects {
                  ...AddressFields
                }
              }
              mobile: addresses_response(
                filter: { address_type: { uuids: $mobile } }
              ) {
                objects {
                  ...AddressFields
                }
              }
              landline: addresses_response(
                filter: { address_type: { uuids: $landline } }
              ) {
                objects {
                  ...AddressFields
                }
              }
            }
          }
        }
      }
    }
  }
}

query read_orgunit($uuid: UUID!) {
  org_units(filter: { uuids: [$uuid] }) {
    objects {
      ...UnitFields
    }
  }
}

query FindAddressUnitOrPerson($uuid: UUID!) {
  addresses(filter: { uuids: [$uuid], from_date: null, to_date: null }) {
    objects {
      validities {
        org_unit_response {
          uuid
        }
        person_response {
          uuid
        }
      }
    }
  }
}

query FindItuserUnitOrPerson($uuid: UUID!) {
  itusers(filter: { uuids: [$uuid], from_date: null, to_date: null }) {
    objects {
      validities {
        org_unit_response {
          uuid
        }
        person_response {
          uuid
        }
      }
    }
  }
}

query FindKLEUnit($uuid: UUID!) {
  itusers(filter: { uuids: [$uuid], from_date: null, to_date: null }) {
    objects {
      validities {
        org_unit_response {
          uuid
        }
      }
    }
  }
}

query FindManagerUnit($uuid: UUID!) {
  managers(filter: { uuids: [$uuid], from_date: null, to_date: null }) {
    objects {
      validities {
        org_unit_response {
          uuid
        }
      }
    }
  }
}

query FindEngagementPerson($uuid: UUID!) {
  engagements(filter: { uuids: [$uuid], from_date: null, to_date: null }) {
    objects {
      validities {
        person_response {
          uuid
        }
      }
    }
  }
}

query FindFKItsystem {
  itsystems(filter: { user_keys: ["FK-ORG-UUID", "FK-ORG UUID"] }) {
    objects {
      uuid
    }
  }
}


mutation CreateITUser(
  $external_id: String!
  $itsystem: UUID!
  $person: UUID!
  $user_key: String!
  $from: DateTime!
) {
  ituser_create(
    input: {
      validity: { from: $from }
      user_key: $user_key
      itsystem: $itsystem
      external_id: $external_id
      person: $person
    }
  ) {
    uuid
  }
}

mutation TerminateITUser($uuid: UUID!, $to: DateTime!) {
  ituser_terminate(input: { uuid: $uuid, to: $to }) {
    uuid
  }
}

query _testing__get_class($filter: ClassFilter) {
  classes(filter: $filter) {
    objects {
      uuid
    }
  }
}

query _testing__get_itsystem($filter: ITSystemFilter) {
  itsystems(filter: $filter) {
    objects {
      uuid
    }
  }
}

mutation _testing__employee_create($input: EmployeeCreateInput!) {
  employee_create(input: $input) {
    uuid
  }
}

mutation _testing__engagement_create($input: EngagementCreateInput!) {
  engagement_create(input: $input) {
    uuid
  }
}

mutation _testing__address_create($input: AddressCreateInput!) {
  address_create(input: $input) {
    uuid
  }
}

mutation _testing__org_unit_create($input: OrganisationUnitCreateInput!) {
  org_unit_create(input: $input) {
    uuid
  }
}

mutation _testing__ituser_create($input: ITUserCreateInput!) {
  ituser_create(input: $input) {
    uuid
  }
}

mutation _testing__itsystem_terminate($input: ITSystemTerminateInput!) {
  itsystem_terminate(input: $input) {
    uuid
  }
}
